<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Skilled-Jobs English: Reading & Writing Tests</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#0f172a;}
    body{max-width:900px;margin:28px auto;padding:20px;background:#fff}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{font-size:1.25rem;margin:0}
    .name-field{font-size:0.95rem;border:1px solid #cbd5e1;border-radius:6px;padding:6px;width:260px}
    .level{border:1px solid #dbe7f7;border-radius:8px;padding:14px;margin:18px 0;background:#ffffff}
    h2{font-size:1.05rem;margin:6px 0}
    .passage{background:#fafafa;padding:10px;border-radius:6px;border:1px solid #eef2f7;margin-bottom:10px;font-size:0.95rem}
    .question{margin:8px 0;padding:8px;border-left:3px solid #e6eef8;background:transparent;border-radius:4px}
    label{display:block;cursor:pointer;margin:3px 0}
    .short-answer{width:100%;min-height:44px;padding:8px;border:1px solid #e6eef8;border-radius:6px;font-size:0.95rem}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    button{background:#0f172a;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    .result{margin-top:12px;padding:10px;border-radius:6px;background:#f8fafc;border:1px solid #e6eef8;font-size:0.95rem}
    textarea{width:100%;min-height:140px;padding:8px;border:1px solid #e6eef8;border-radius:6px;font-size:0.95rem}
    .hint{font-size:0.9rem;color:#0f172a;background:#fbfbfb;padding:10px;border-radius:6px;border:1px solid #eef2f7}
    footer{margin-top:22px;font-size:0.9rem;color:#334155}
    @media (max-width:700px){header{flex-direction:column;align-items:flex-start}.name-field{width:100%}}
  </style>
</head>
<body>
  <header>
    <h1>Skilled-Jobs English — Reading & Writing</h1>
    <div>
      <label for="candidateName"><strong>Candidate Name:</strong></label><br>
      <input id="candidateName" class="name-field" type="text" placeholder="Write your full name here">
    </div>
  </header>

  <p class="hint"><strong>Instructions:</strong> Complete all sections. After finishing, follow Final Instructions at the bottom to export your results and send them to the examiner.</p>

  <!-- (your test sections remain the same — A1T1 through WritingEmail) -->

  <div class="hint" id="finalInstructions">
    <strong>Final instructions (candidates):</strong>
    <ol>
      <li>Type your <strong>full name</strong> in the Candidate Name field at the top.</li>
      <li>When you have finished all sections, click <strong>Export Results to PDF</strong>. The file will be saved to your device.</li>
      <li>Send the saved PDF to: <strong>susan.centino@cirrusrecruitment.com</strong></li>
    </ol>
  </div>

  <footer>
    <div id="adminControls">
      <button id="btnExportPDF">Export Results to PDF</button>
    </div>
  </footer>

  <!-- ✅ jsPDF CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // --- scoring helpers ---
    const getRadioScore = (name, correctValue) => {
      const r = document.querySelector(`input[name="${name}"]:checked`);
      return r && r.value === correctValue ? 1 : 0;
    };
    const getTextScore = (id, answer) => {
      const t = document.getElementById(id).value.trim().toLowerCase();
      return t.includes(answer) ? 1 : 0;
    };
    const wordsCount = s => s.trim().split(/\s+/).filter(Boolean).length;

    // --- Reading scoring ---
    const readingTests = [
      {btn:'btnA1T1', id:'A1T1', score:()=>getRadioScore('a1t1_q1','6')+getRadioScore('a1t1_q2','mark')+getTextScore('a1t1_q3','bus')},
      {btn:'btnA1T2', id:'A1T2', score:()=>getRadioScore('a1t2_q1','plumber')+getTextScore('a1t2_q2','12:30')},
      {btn:'btnA2T1', id:'A2T1', score:()=>getRadioScore('a2t1_q1','beach')+getTextScore('a2t1_q2','leader')},
      {btn:'btnA2T2', id:'A2T2', score:()=>getRadioScore('a2t2_q1','experience')+getTextScore('a2t2_q2','start')},
      {btn:'btnB1T1', id:'B1T1', score:()=>getRadioScore('b1t1_q1','language')+getTextScore('b1t1_q2','support')},
      {btn:'btnB1T2', id:'B1T2', score:()=>getRadioScore('b1t2_q1','equipment')+getTextScore('b1t2_q2','aware')}
    ];
    readingTests.forEach(t=>{
      document.getElementById(t.btn).addEventListener('click',()=>{
        const s=t.score();
        document.getElementById('result'+t.id).innerHTML=`<strong>Score:</strong> ${s}`;
      });
    });

    // --- Writing scoring ---
    document.getElementById('btnEssay').addEventListener('click',()=>{
      const wc=wordsCount(document.getElementById('essayText').value);
      document.getElementById('resultEssay').innerHTML=`<strong>Score (words count):</strong> ${wc}`;
    });
    document.getElementById('btnEmail').addEventListener('click',()=>{
      const wc=wordsCount(document.getElementById('emailText').value);
      document.getElementById('resultEmail').innerHTML=`<strong>Score (words count):</strong> ${wc}`;
    });

    // --- helper for CEFR conversion ---
    function writingScoreAndLevel(words){
      if(words<50)return{score:0,level:"Below A1"};
      if(words<100)return{score:1,level:"A1"};
      if(words<150)return{score:2,level:"A2"};
      if(words<200)return{score:3,level:"B1"};
      if(words<250)return{score:4,level:"B2"};
      return{score:5,level:"C1"};
    }

    // --- determine CEFR by reading scores ---
    function determineCEFR(readingScores){
      let highest='A1',max=readingScores.A1;
      for(const lvl in readingScores){
        if(readingScores[lvl]>max){max=readingScores[lvl];highest=lvl;}
      }
      return highest;
    }

    // --- export to PDF ---
    document.getElementById('btnExportPDF').addEventListener('click',()=>{
      const { jsPDF } = window.jspdf;
      const doc=new jsPDF();
      const name=document.getElementById('candidateName').value.trim()||'(No name)';

      // Collect scores
      const getScore=(id)=>parseInt((document.getElementById('result'+id)?.innerText.match(/\d+/)||[0])[0]);
      const readingScores={
        A1:getScore('A1T1')+getScore('A1T2'),
        A2:getScore('A2T1')+getScore('A2T2'),
        B1:getScore('B1T1')+getScore('B1T2')
      };
      const essayW=getScore('Essay');
      const emailW=getScore('Email');
      const essayEval=writingScoreAndLevel(essayW);
      const emailEval=writingScoreAndLevel(emailW);
      const readingLevel=determineCEFR(readingScores);

      // --- PDF layout ---
      let y=20;
      doc.setFontSize(16);
      doc.text(`Candidate: ${name}`,10,y);y+=10;

      doc.setFontSize(14);
      doc.text('Reading Comprehension',10,y);y+=8;
      doc.setFontSize(12);
      doc.text(`A1 Total: ${readingScores.A1}`,10,y);y+=6;
      doc.text(`A2 Total: ${readingScores.A2}`,10,y);y+=6;
      doc.text(`B1 Total: ${readingScores.B1}`,10,y);y+=8;
      doc.text(`Highest Reading Level: ${readingLevel}`,10,y);y+=12;

      doc.setFontSize(14);
      doc.text('Writing Results',10,y);y+=8;
      doc.setFontSize(12);
      doc.text(`Essay Word Count: ${essayW} → Level: ${essayEval.level}`,10,y);y+=6;
      doc.text(`Email Word Count: ${emailW} → Level: ${emailEval.level}`,10,y);y+=10;

      doc.setFontSize(14);
      doc.text('Overall Summary',10,y);y+=8;
      doc.setFontSize(12);
      doc.text(`Reading Level: ${readingLevel}`,10,y);y+=6;
      doc.text(`Writing Level: ${essayEval.level===emailEval.level?essayEval.level:essayEval.level+'/'+emailEval.level}`,10,y);y+=10;
      doc.text('End of Report',10,y);

      const filename=`${name.replace(/\s+/g,'_')}_Assessment.pdf`;
      doc.save(filename);
    });
  });
  </script>
</body>
</html>
