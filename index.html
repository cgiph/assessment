<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Skilled-Jobs English: Reading & Writing Tests</title>
  <style>
    :root {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color: #0f172a;
    }
    body {
      max-width: 900px;
      margin: 28px auto;
      padding: 20px;
      background: #fff;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    h1 { font-size: 1.25rem; margin: 0; }
    .name-field {
      font-size: 0.95rem;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      padding: 6px;
      width: 260px;
    }
    .level {
      border: 1px solid #dbe7f7;
      border-radius: 8px;
      padding: 14px;
      margin: 18px 0;
      background: #ffffff;
    }
    h2 { font-size: 1.05rem; margin: 6px 0; }
    .passage {
      background: #fafafa;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #eef2f7;
      margin-bottom: 10px;
      font-size: 0.95rem;
    }
    .question { margin: 8px 0; padding: 8px; border-left: 3px solid #e6eef8; border-radius: 4px; }
    label { display: block; cursor: pointer; margin: 3px 0; }
    .short-answer { width: 100%; min-height: 44px; padding: 8px; border: 1px solid #e6eef8; border-radius: 6px; font-size: 0.95rem; }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
    button { background: #0f172a; color: #fff; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
    .result { margin-top: 12px; padding: 10px; border-radius: 6px; background: #f8fafc; border: 1px solid #e6eef8; font-size: 0.95rem; min-height: 26px; }
    textarea { width: 100%; min-height: 140px; padding: 8px; border: 1px solid #e6eef8; border-radius: 6px; font-size: 0.95rem; }
    .hint { font-size: 0.9rem; color: #0f172a; background: #fbfbfb; padding: 10px; border-radius: 6px; border: 1px solid #eef2f7; }
    footer { margin-top: 22px; font-size: 0.9rem; color: #334155; }
    @media (max-width:700px){ header{flex-direction:column;align-items:flex-start} .name-field{width:100%} }
  </style>
</head>
<body>

<header>
  <h1>Skilled-Jobs English — Reading & Writing</h1>
  <div>
    <label for="candidateName"><strong>Candidate Name:</strong></label><br>
    <input id="candidateName" class="name-field" type="text" placeholder="Write your full name here">
  </div>
</header>

<p class="hint">
  <strong>Instructions:</strong> Open this file on Chrome. Complete all sections.
  After finishing, follow Final Instructions at the bottom to save your test and send it to the assessor.
</p>

<!-- READING & WRITING SECTIONS (unchanged content) -->
<section class="level" id="A1T1">
  <h2>A1 Test 1 – Reading</h2>
  <div class="passage">Mark takes bus number 6 to go to work every morning. He usually sits near the window and reads the newspaper. The bus stop is close to his house.</div>
  <div class="question">
    <p>1. What bus number does Mark take?</p>
    <label><input type="radio" name="a1t1_q1" value="6"> 6</label>
    <label><input type="radio" name="a1t1_q1" value="10"> 10</label>
    <label><input type="radio" name="a1t1_q1" value="5"> 5</label>
  </div>
  <div class="question">
    <p>2. Where does Mark read the newspaper?</p>
    <label><input type="radio" name="a1t1_q2" value="home"> At home</label>
    <label><input type="radio" name="a1t1_q2" value="mark"> On the bus</label>
  </div>
  <div class="question">
    <p>3. What kind of transport does he use?</p>
    <input id="a1t1_q3" class="short-answer" placeholder="Type your answer">
  </div>
  <div class="controls"><button id="btnA1T1">Submit</button></div>
  <div id="resultA1T1" class="result"></div>
</section>

<section class="level" id="A1T2">
  <h2>A1 Test 2 – Reading</h2>
  <div class="passage">
    Joe is a plumber. He starts work at 8:00 and finishes at half past 12. He enjoys fixing pipes and helping people with water problems.
  </div>
  <div class="question">
    <p>1. What is Joe’s job?</p>
    <label><input type="radio" name="a1t2_q1" value="plumber"> Plumber</label>
    <label><input type="radio" name="a1t2_q1" value="driver"> Driver</label>
  </div>
  <div class="question">
    <p>2. What time does he finish work?</p>
    <input id="a1t2_q2" class="short-answer" placeholder="Type your answer">
  </div>
  <div class="controls"><button id="btnA1T2">Submit</button></div>
  <div id="resultA1T2" class="result"></div>
</section>

<section class="level" id="A2T1">
  <h2>A2 Test 1 – Reading</h2>
  <div class="passage">
    During the summer, our group goes on vacation every weekend at the beach. I lead a group of sales rep, and plan the team-building activity for collaboration and motivation.
  </div>
  <div class="question">
    <p>1. Where does the group go on weekends?</p>
    <label><input type="radio" name="a2t1_q1" value="mountain"> The mountain</label>
    <label><input type="radio" name="a2t1_q1" value="beach"> The beach</label>
  </div>
  <div class="question">
    <p>2. What is the writer’s role?</p>
    <input id="a2t1_q2" class="short-answer" placeholder="Type your answer">
  </div>
  <div class="controls"><button id="btnA2T1">Submit</button></div>
  <div id="resultA2T1" class="result"></div>
</section>

<section class="level" id="A2T2">
  <h2>A2 Test 2 – Reading</h2>
  <div class="passage">
    My first job was at a restaurant. It was not an easy start because I had no experience. But my manager helped me to learn the ropes and become efficient at my work.
  </div>
  <div class="question">
    <p>1. What did the writer not have?</p>
    <label><input type="radio" name="a2t2_q1" value="experience"> Experience</label>
    <label><input type="radio" name="a2t2_q1" value="money"> Money</label>
  </div>
  <div class="question">
    <p>2. What did the manager help the writer to do?</p>
    <input id="a2t2_q2" class="short-answer" placeholder="Type your answer">
  </div>
  <div class="controls"><button id="btnA2T2">Submit</button></div>
  <div id="resultA2T2" class="result"></div>
</section>

<section class="level" id="A2T3">
  <h2>A2 Test 3 – Workplace Interaction</h2>
  <div class="passage">
    You have a co-worker, Alex, who often criticizes your work in front of others. You feel uncomfortable but want to solve the problem politely. You decide to talk to Alex after work.
  </div>
  <div class="question">
    <p>1. What is the best way to start your conversation with Alex?</p>
    <label><input type="radio" name="a2t3_q1" value="a"> "You always embarrass me in front of people!"</label>
    <label><input type="radio" name="a2t3_q1" value="b"> "Can we talk for a minute? I’d like to understand your feedback better."</label>
    <label><input type="radio" name="a2t3_q1" value="c"> "I don’t care what you think about my work."</label>
    <label><input type="radio" name="a2t3_q1" value="d"> "Why do you always have to complain?"</label>
  </div>
  <div class="controls"><button id="btnA2T3">Submit</button></div>
  <div id="resultA2T3" class="result"></div>
</section>

<section class="level" id="B1T1">
  <h2>B1 Test 1 – Reading</h2>
  <div class="passage">
    Learning another language can be difficult, but it gives you more opportunities to communicate effectively, especially in the workplace. That is why many companies look for employees who can communicate in different languages.
  </div>
  <div class="question">
    <p>1. What do many companies look for?</p>
    <label><input type="radio" name="b1t1_q1" value="language"> People who can speak other languages</label>
    <label><input type="radio" name="b1t1_q1" value="friends"> People with many friends</label>
  </div>
  <div class="question">
    <p>2. What do languages help people to do?</p>
    <input id="b1t1_q2" class="short-answer" placeholder="Type your answer">
  </div>
  <div class="controls"><button id="btnB1T1">Submit</button></div>
  <div id="resultB1T1" class="result"></div>
</section>

<section class="level" id="B1T2">
  <h2>B1 Test 2 – Reading</h2>
  <div class="passage">
    Before using any equipment, workers must be aware of the safety rules, like wearing gloves, goggles, and helmets to prevent serious injuries.
  </div>
  <div class="question">
    <p>1. What should workers know before using equipment?</p>
    <label><input type="radio" name="b1t2_q1" value="rules"> injuries</label>
    <label><input type="radio" name="b1t2_q1" value="safety"> safety rules</label>
  </div>
  <div class="question">
    <p>2. Name the safety rule mentioned.</p>
    <input id="b1t2_q2" class="short-answer" placeholder="Type your answer">
  </div>
  <div class="controls"><button id="btnB1T2">Submit</button></div>
  <div id="resultB1T2" class="result"></div>
</section>

<section class="level" id="B1T3">
  <h2>B1 Test 3 – Reading</h2>
  <div class="passage">
    A client complained about a delay in delivery. As a leader, you need to respond to the client and explain that your team is already fixing the issue.
  </div>
  <div class="question">
    <p>1. What should the team leader do in the email?</p>
    <input id="b1t3_q1" class="short-answer" placeholder="Type your answer">
  </div>
  <div class="controls"><button id="btnB1T3">Submit</button></div>
  <div id="resultB1T3" class="result"></div>
</section>

<section class="level" id="Essay">
  <h2>Writing Task 1 – Essay</h2>
  <p>Write an essay not less than 100 words: <strong>Why learning English is important for your future job.</strong></p>
  <textarea id="essayText" placeholder="Write your essay here..."></textarea>
  <div class="controls"><button id="btnEssay">Submit</button></div>
  <div id="resultEssay" class="result"></div>
</section>

<section class="level" id="Email">
  <h2>Writing Task 2 – Email</h2>
  <p>Your team leader emailed you about a mentorship program for the new apprentice, Leonard. <strong>Write your email reply not less than 40 words.</strong></p>
  <textarea id="emailText" placeholder="Write your email here..."></textarea>
  <div class="controls"><button id="btnEmail">Submit</button></div>
  <div id="resultEmail" class="result"></div>
</section>

<div class="hint" id="finalInstructions">
  <strong>Final instructions (candidates):</strong>
  <ol>
    <li>Type your <strong>full name</strong> in the Candidate Name field at the top.</li>
    <li>When you have finished all sections, click <strong>Save Results to PDF</strong>. The file will be saved to your device.</li>
    <li>Send the PDF to: <strong>susan.centino@cirrusrecruitment.com</strong> or Messenger.</li>
  </ol>
</div>

<footer>
  <button id="btnSavePDF">Save Results to PDF</button>
</footer>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/*
  Single, consolidated script:
  - submit buttons compute and display scores/results in each .result box
  - PDF button collects the shown results and writing word counts/levels and saves a tidy PDF
*/

document.addEventListener('DOMContentLoaded', () => {

  // Utility: normalize short answer (lowercase, collapse punctuation/extra spaces)
  function normalizeText(s){
    return (s||'').toString().trim().toLowerCase().replace(/[^\w\s:]/g,'').replace(/\s+/g,' ');
  }

  // Compare short-answer with one or multiple acceptable tokens
  function shortAnswerMatches(id, acceptable){
    const val = normalizeText(document.getElementById(id).value);
    if(!val) return false;
    acceptable = Array.isArray(acceptable) ? acceptable : [acceptable];
    return acceptable.some(a => {
      const n = normalizeText(a);
      return n && (val === n || val.includes(n) || n.includes(val));
    });
  }

  // Radio check helper
  function radioIs(name, value){
    const r = document.querySelector('input[name="'+name+'"]:checked');
    return r && r.value === value;
  }

  // Word count helper
  function countWords(s){
    if(!s) return 0;
    return s.trim().split(/\s+/).filter(Boolean).length;
  }

  // CEFR mapping for writing (based on word count)
  function writingScoreAndLevel(w){
    if(w < 10) return {score:0,level:'Below A1'};
    if(w < 20) return {score:1,level:'A1'};
    if(w < 50) return {score:2,level:'A2'};
    if(w < 100) return {score:3,level:'B1'};
    if(w < 200) return {score:4,level:'B2'};
    return {score:5,level:'C1'};
  }

  // Attach handlers for reading tests
  const readingHandlers = [
    {
      btnId: 'btnA1T1',
      resultId: 'resultA1T1',
      run: () => {
        let score = 0;
        score += radioIs('a1t1_q1','6') ? 1 : 0;
        score += radioIs('a1t1_q2','mark') ? 1 : 0;
        score += shortAnswerMatches('a1t1_q3', ['bus','bus transport','bus']); // accept variants
        return {text:`Score: ${score}`};
      }
    },
    {
      btnId: 'btnA1T2',
      resultId: 'resultA1T2',
      run: () => {
        let score = 0;
        score += radioIs('a1t2_q1','plumber') ? 1 : 0;
        // accept "12:30", "half past 12", "12.30", "12:30pm" etc.
        const t = normalizeText(document.getElementById('a1t2_q2').value);
        if(t && (t.includes('12:30') || t.includes('1230') || t.includes('half past 12') || t.includes('12.30'))) score += 1;
        return {text:`Score: ${score}`};
      }
    },
    {
      btnId: 'btnA2T1',
      resultId: 'resultA2T1',
      run: () => {
        let score = 0;
        score += radioIs('a2t1_q1','beach') ? 1 : 0;
        score += shortAnswerMatches('a2t1_q2', ['leader','i lead','lead a group','sales lead','sales rep lead']);
        return {text:`Score: ${score}`};
      }
    },
    {
      btnId: 'btnA2T2',
      resultId: 'resultA2T2',
      run: () => {
        let score = 0;
        score += radioIs('a2t2_q1','experience') ? 1 : 0;
        score += shortAnswerMatches('a2t2_q2', ['learn the ropes','learn the ropes','start','become efficient','learn']);
        return {text:`Score: ${score}`};
      }
    },
    {
      btnId: 'btnA2T3',
      resultId: 'resultA2T3',
      run: () => {
        // best answer is 'b'
        let score = radioIs('a2t3_q1','b') ? 1 : 0;
        return {text:`Score: ${score}`};
      }
    },
    {
      btnId: 'btnB1T1',
      resultId: 'resultB1T1',
      run: () => {
        let score = 0;
        score += radioIs('b1t1_q1','language') ? 1 : 0;
        score += shortAnswerMatches('b1t1_q2', ['communicate','communicate effectively','communication']);
        return {text:`Score: ${score}`};
      }
    },
    {
      btnId: 'btnB1T2',
      resultId: 'resultB1T2',
      run: () => {
        let score = 0;
        score += radioIs('b1t2_q1','safety') ? 1 : 0;
        score += shortAnswerMatches('b1t2_q2', ['gloves','goggles','helmets','wearing gloves','wearing goggles','wearing helmets','wearing']);
        return {text:`Score: ${score}`};
      }
    },
    {
      btnId: 'btnB1T3',
      resultId: 'resultB1T3',
      run: () => {
        // expected: leader apologises and explains fix
        const ok = shortAnswerMatches('b1t3_q1',['apologize','sorry','explain','we are fixing','we are addressing']);
        return {text:`Score: ${ok ? 1 : 0}`};
      }
    }
  ];

  // wire reading handlers
  readingHandlers.forEach(h => {
    const btn = document.getElementById(h.btnId);
    if(btn){
      btn.addEventListener('click', () => {
        const res = h.run();
        const out = document.getElementById(h.resultId);
        if(out) out.innerHTML = `<strong>${res.text}</strong>`;
      });
    }
  });

  // Writing submit handlers (compute word count + level and display)
  document.getElementById('btnEssay').addEventListener('click', () => {
    const text = document.getElementById('essayText').value || '';
    const wc = countWords(text);
    const lvl = writingScoreAndLevel(wc);
    document.getElementById('resultEssay').innerHTML = `<strong>Word count:</strong> ${wc} — <strong>Level:</strong> ${lvl.level}`;
  });

  document.getElementById('btnEmail').addEventListener('click', () => {
    const text = document.getElementById('emailText').value || '';
    const wc = countWords(text);
    const lvl = writingScoreAndLevel(wc);
    document.getElementById('resultEmail').innerHTML = `<strong>Word count:</strong> ${wc} — <strong>Level:</strong> ${lvl.level}`;
  });

  // PDF generator: collects visible .result fields and writing results
  document.getElementById('btnSavePDF').addEventListener('click', async () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: 'pt', format: 'a4' });
    let y = 50;
    doc.setFontSize(16);
    const candidate = (document.getElementById('candidateName').value || '(No name)').trim();
    doc.text("Skilled-Jobs English Test Results", 300, y, { align: 'center' });
    y += 30;
    doc.setFontSize(11);
    doc.text(`Candidate: ${candidate}`, 40, y);
    y += 20;

    doc.setFontSize(13);
    doc.text("Reading Test Results", 40, y);
    y += 18;
    doc.setFontSize(10);

    // loop sections with h2 and result
    document.querySelectorAll('.level').forEach(section => {
      const h = section.querySelector('h2') ? section.querySelector('h2').innerText : '';
      const r = section.querySelector('.result') ? section.querySelector('.result').innerText : '';
      // include tests & writing sections
      if(h){
        // wrap if text lengthy
        const label = `${h}:`;
        const combined = r ? `${label} ${r}` : `${label} Not answered`;
        const lines = doc.splitTextToSize(combined, 500);
        doc.text(lines, 40, y);
        y += lines.length * 14;
        if(y > 740){ doc.addPage(); y = 40; } // new page if near bottom
      }
    });

    // If essay/email results were not computed with Submit, compute now for PDF
    const essayText = document.getElementById('essayText').value || '';
    const essayWords = countWords(essayText);
    const essayLevel = writingScoreAndLevel(essayWords);

    const emailText = document.getElementById('emailText').value || '';
    const emailWords = countWords(emailText);
    const emailLevel = writingScoreAndLevel(emailWords);

    // Final summary block
    y += 10;
    if(y > 740){ doc.addPage(); y = 40; }
    doc.setFontSize(12);
    doc.text("Final Summary", 40, y); y += 16;
    doc.setFontSize(11);

    // Compute average reading score from displayed result boxes (those that contain "Score:")
    const readingScores = Array.from(document.querySelectorAll('.result'))
      .map(el => el.innerText)
      .filter(t => t && t.match(/Score:/))
      .map(t => {
        const m = t.match(/Score:\s*(\d+(\.\d+)?)/);
        return m ? Number(m[1]) : 0;
      });

    const avgReading = readingScores.length ? (readingScores.reduce((a,b)=>a+b,0)/readingScores.length) : 0;
    const avgReadingRounded = (Math.round(avgReading*10)/10).toFixed(1);

    // map numeric average to CEFR + percentage (same mapping you requested)
    function readingLevelFromScore(score){
      // score is expected as numeric average (0..5 scale)
      if(score < 0.5) return {level:'Below A1', percent:'0–19%'};
      if(score < 1.5) return {level:'A1', percent:'20–39%'};
      if(score < 2.5) return {level:'A2', percent:'40–59%'};
      if(score < 3.5) return {level:'B1', percent:'60–74%'};
      if(score < 4.5) return {level:'B2', percent:'75–89%'};
      return {level:'C1', percent:'90–100%'};
    }
    const avgInfo = readingLevelFromScore(Number(avgReadingRounded));

    doc.text(`Average Reading Score: ${avgReadingRounded} (${avgInfo.level}, ${avgInfo.percent})`, 40, y); y += 16;
    doc.text(`Essay: ${essayWords} words — Level: ${essayLevel.level}`, 40, y); y += 14;
    doc.text(`Email: ${emailWords} words — Level: ${emailLevel.level}`, 40, y); y += 14;

    // Save PDF
    const filename = `${candidate.replace(/\s+/g,'_') || 'Candidate'}_English_Test_Results.pdf`;
    doc.save(filename);
  });

}); // DOMContentLoaded
</script>

</body>
</html>
