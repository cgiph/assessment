<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Skilled-Jobs English: Reading & Writing Tests</title>
  <style>
    /* Simple, exam-like styling */
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; color:#0f172a;}
    body{max-width:900px;margin:28px auto;padding:20px;background:#fff}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{font-size:1.25rem;margin:0}
    .name-field{font-size:0.95rem;border:1px solid #cbd5e1;border-radius:6px;padding:6px;width:260px}
    .level{border:1px solid #dbe7f7;border-radius:8px;padding:14px;margin:18px 0;background:#ffffff}
    h2{font-size:1.05rem;margin:6px 0}
    .passage{background:#fafafa;padding:10px;border-radius:6px;border:1px solid #eef2f7;margin-bottom:10px;font-size:0.95rem}
    .question{margin:8px 0;padding:8px;border-left:3px solid #e6eef8;background:transparent;border-radius:4px}
    label{display:block;cursor:pointer;margin:3px 0}
    .short-answer{width:100%;min-height:44px;padding:8px;border:1px solid #e6eef8;border-radius:6px;font-size:0.95rem}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    button{background:#0f172a;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    .result{margin-top:12px;padding:10px;border-radius:6px;background:#f8fafc;border:1px solid #e6eef8;font-size:0.95rem}
    textarea{width:100%;min-height:140px;padding:8px;border:1px solid #e6eef8;border-radius:6px;font-size:0.95rem}
    .hint{font-size:0.9rem;color:#0f172a;background:#fbfbfb;padding:10px;border-radius:6px;border:1px solid #eef2f7}
    footer{margin-top:22px;font-size:0.9rem;color:#334155}
    .hidden{display:none}
    @media (max-width:700px){header{flex-direction:column;align-items:flex-start} .name-field{width:100%}}
  </style>
</head>
<body>
  <header>
    <h1>Skilled-Jobs English — Reading & Writing</h1>
    <div>
      <label for="candidateName"><strong>Candidate Name:</strong></label><br>
      <input id="candidateName" class="name-field" type="text" placeholder="Write your full name here">
    </div>
  </header>

  <p class="hint"><strong>Instructions:</strong> Complete all sections. After finishing, follow Final Instructions at the bottom to export your results and send them to the examiner.</p>

  <!-- A1 Test 1 -->
  <section class="level" id="A1T1">
    <h2>A1 — Reading Test 1</h2>
    <div class="passage"><strong>Passage:</strong> Anna works in a small bakery. Every morning she opens the shop at 6:00 a.m. She bakes bread and sells coffee. Her friend Mark helps on weekends. The bakery is near a bus stop, so many people come to buy breakfast.</div>
    <div class="question">
      <label>1) What time does Anna open the shop?</label>
      <label><input type="radio" name="a1t1_q1" value="5"> 5:00 a.m.</label>
      <label><input type="radio" name="a1t1_q1" value="6"> 6:00 a.m.</label>
      <label><input type="radio" name="a1t1_q1" value="7"> 7:00 a.m.</label>
    </div>
    <div class="question">
      <label>2) Who helps Anna on weekends?</label>
      <label><input type="radio" name="a1t1_q2" value="mark"> Mark</label>
      <label><input type="radio" name="a1t1_q2" value="john"> John</label>
      <label><input type="radio" name="a1t1_q2" value="noone"> No one</label>
    </div>
    <div class="question">
      <label>3) Short answer — Where is the bakery located?</label>
      <input id="a1t1_q3" class="short-answer" placeholder="e.g., near a bus stop">
    </div>
    <div class="controls"><button id="btnA1T1">Submit A1 Test 1</button></div>
    <div id="resA1T1" class="result" aria-live="polite"></div>
  </section>

  <!-- A1 Test 2 -->
  <section class="level" id="A1T2">
    <h2>A1 — Reading Test 2</h2>
    <div class="passage"><strong>Passage:</strong> Tom is a plumber. He fixes taps and pipes. Today he goes to a house. The family says thank you because the water works again. Tom has lunch at 12:30 and returns to the office at 2:00.</div>
    <div class="question">
      <label>1) What is Tom's job?</label>
      <label><input type="radio" name="a1t2_q1" value="teacher"> Teacher</label>
      <label><input type="radio" name="a1t2_q1" value="plumber"> Plumber</label>
      <label><input type="radio" name="a1t2_q1" value="driver"> Driver</label>
    </div>
    <div class="question">
      <label>2) Short answer — When does Tom have lunch?</label>
      <input id="a1t2_q2" class="short-answer" placeholder="e.g., 12:30">
    </div>
    <div class="controls"><button id="btnA1T2">Submit A1 Test 2</button></div>
    <div id="resA1T2" class="result" aria-live="polite"></div>
  </section>

  <!-- A2 Test 1 -->
  <section class="level" id="A2T1">
    <h2>A2 — Reading Test 1</h2>
    <div class="passage"><strong>Passage:</strong> Maria moved to Sydney last year to work as an electrician. She likes the city because she can walk to the beach on weekends. On weekdays she travels by train. Maria studies for a trade certificate in the evenings and hopes to become a team leader in two years.</div>
    <div class="question">
      <label>1) Why does Maria like the city?</label>
      <label><input type="radio" name="a2t1_q1" value="food"> Because of the food</label>
      <label><input type="radio" name="a2t1_q1" value="beach"> Because she can walk to the beach</label>
      <label><input type="radio" name="a2t1_q1" value="train"> Because trains are cheap</label>
    </div>
    <div class="question">
      <label>2) Short answer — What does Maria hope to become?</label>
      <input id="a2t1_q2" class="short-answer" placeholder="e.g., a team leader">
    </div>
    <div class="controls"><button id="btnA2T1">Submit A2 Test 1</button></div>
    <div id="resA2T1" class="result" aria-live="polite"></div>
  </section>

  <!-- A2 Test 2 -->
  <section class="level" id="A2T2">
    <h2>A2 — Reading Test 2</h2>
    <div class="passage"><strong>Passage:</strong> Job ads often ask for two things: experience and a current visa. If the applicant has experience but no visa, it is difficult to hire them. Many employers prefer candidates who can start quickly and speak clear English.</div>
    <div class="question">
      <label>1) What do job ads often ask for?</label>
      <label><input type="radio" name="a2t2_q1" value="salary"> High salary</label>
      <label><input type="radio" name="a2t2_q1" value="experience"> Experience and a current visa</label>
      <label><input type="radio" name="a2t2_q1" value="location"> A car</label>
    </div>
    <div class="question">
      <label>2) Short answer — Why do employers prefer some candidates?</label>
      <input id="a2t2_q2" class="short-answer" placeholder="e.g., they can start quickly and speak clear English">
    </div>
    <div class="controls"><button id="btnA2T2">Submit A2 Test 2</button></div>
    <div id="resA2T2" class="result" aria-live="polite"></div>
  </section>

  <!-- B1 Test 1 -->
  <section class="level" id="B1T1">
    <h2>B1 — Reading Test 1</h2>
    <div class="passage"><strong>Passage:</strong> Many skilled workers move between cities to follow job opportunities. Relocating can be positive — it often brings higher pay and new skills — but it also has costs: finding housing, changing schools for children, and the time needed to settle in. Employers who offer relocation support are more likely to attract experienced candidates. Some companies give a relocation allowance, others help with temporary accommodation.</div>
    <div class="question">
      <label>1) Which of the following is NOT listed as a cost of relocating?</label>
      <label><input type="radio" name="b1t1_q1" value="housing"> Finding housing</label>
      <label><input type="radio" name="b1t1_q1" value="schools"> Changing schools for children</label>
      <label><input type="radio" name="b1t1_q1" value="language"> Learning a new language</label>
    </div>
    <div class="question">
      <label>2) Short answer — How do some companies support relocating employees?</label>
      <input id="b1t1_q2" class="short-answer" placeholder="e.g., with a relocation allowance or temporary accommodation">
    </div>
    <div class="controls"><button id="btnB1T1">Submit B1 Test 1</button></div>
    <div id="resB1T1" class="result" aria-live="polite"></div>
  </section>

  <!-- B1 Test 2 -->
  <section class="level" id="B1T2">
    <h2>B1 — Reading Test 2</h2>
    <div class="passage"><strong>Passage:</strong> Workplace safety is important in trades such as construction and manufacturing. Australian regulations require employers to provide protective equipment and training. Workers should report hazards immediately so managers can act. Regular safety meetings help teams stay aware of risks and improve procedures.</div>
    <div class="question">
      <label>1) What must employers provide according to the passage?</label>
      <label><input type="radio" name="b1t2_q1" value="equipment"> Protective equipment and training</label>
      <label><input type="radio" name="b1t2_q1" value="salary"> Higher salaries</label>
      <label><input type="radio" name="b1t2_q1" value="lodging"> Lodging</label>
    </div>
    <div class="question">
      <label>2) Short answer — Why are regular safety meetings useful?</label>
      <input id="b1t2_q2" class="short-answer" placeholder="e.g., to stay aware of risks and improve procedures">
    </div>
    <div class="controls"><button id="btnB1T2">Submit B1 Test 2</button></div>
    <div id="resB1T2" class="result" aria-live="polite"></div>
  </section>

  <!-- Writing: Essay -->
  <section class="level" id="WritingEssay">
    <h2>Writing — Essay</h2>
    <div class="passage"><strong>Task:</strong> Describe a time when you improved a process at work. Explain what the problem was, what steps you took, and what the result was. Write 150–300 words if possible.</div>
    <textarea id="essayText" placeholder="Write your essay here..."></textarea>
    <div class="rubric"><strong>Suggested scoring guide:</strong> Content (0–6), Coherence (0–4), Grammar (0–6), Vocabulary & Spelling (0–4) — Total 20</div>
    <div class="controls"><button id="btnEssay">Submit Essay</button></div>
    <div id="resEssay" class="result" aria-live="polite"></div>
  </section>

  <!-- Writing: Email -->
  <section class="level" id="WritingEmail">
    <h2>Writing — Formal Email</h2>
    <div class="passage"><strong>Task:</strong> Write a polite email to a recruitment officer to ask to reschedule a job interview. Provide two alternative dates/times. Suggested 80–150 words.</div>
    <textarea id="emailText" placeholder="Write your email here..."></textarea>
    <div class="rubric"><strong>Suggested scoring guide:</strong> Task (0–5), Tone/Structure (0–5), Grammar (0–5), Clarity (0–5) — Total 20</div>
    <div class="controls"><button id="btnEmail">Submit Email</button></div>
    <div id="resEmail" class="result" aria-live="polite"></div>
  </section>

  <div class="hint" id="finalInstructions">
    <strong>Final instructions (candidates):</strong>
    <ol>
      <li>Type your <strong>full name</strong> in the Candidate Name field at the top.</li>
      <li>When you have finished all sections, press <strong>Ctrl + Alt + E</strong> to unlock Examiner Tools.</li>
      <li>Click <strong>Export Results to PDF</strong>. A confirmation will ask you to check your name. If you continue, a printable page opens and your browser's Print dialog will appear. Choose “Save as PDF” (or Print → Save as PDF) and save the file. The print dialog will suggest a filename that includes your name automatically.</li>
      <li>Send the saved PDF to: <strong>susan.centino@cirrusrecruitment.com</strong> or send via Messenger if you do not have an email account.</li>
    </ol>
  </div>

  <footer>
    <p>Results are saved locally on your device. Examiner tools (clear/export) are hidden until unlocked.</p>

    <div id="adminControls" class="hidden">
      <button id="btnClearData">Clear Candidate Data</button>
      <button id="btnExportPDF">Export Results to PDF</button>
    </div>
    <div id="postExportMsg" class="result hidden" aria-live="polite"></div>
  </footer>

  <script>
    /* Helper utilities */
    function normalize(s){ return String(s||'').trim().toLowerCase(); }
    function wordsCount(s){ if(!s) return 0; return s.trim().split(/\s+/).filter(Boolean).length; }

    /* Persistence */
    function persist(candidateName, key, value){
      if(!candidateName) candidateName='(No name)';
      const storeKey = 'skilledtest_' + candidateName;
      let obj = {};
      try { obj = JSON.parse(localStorage.getItem(storeKey)) || {}; } catch(e) { obj = {}; }
      obj[key] = value;
      localStorage.setItem(storeKey, JSON.stringify(obj));
    }
    function loadStored(candidateName){
      if(!candidateName) candidateName='(No name)';
      const storeKey = 'skilledtest_' + candidateName;
      try { return JSON.parse(localStorage.getItem(storeKey)) || {}; } catch(e) { return {}; }
    }

    /* Save visible result and persist score object */
    function saveResult(domId, score, total, notes){
      const name = document.getElementById('candidateName').value.trim() || '(No name)';
      const el = document.getElementById(domId);
      el.innerHTML = `<strong>Candidate:</strong> ${name} <br><strong>Score:</strong> ${score}/${total} <br><strong>Notes:</strong> ${notes.join(' ')}`;
      persist(name, domId, { score, total, notes, timestamp: new Date().toISOString() });
      updateOverallSummary(name);
    }

    function updateOverallSummary(name){
      const data = loadStored(name);
      let gained=0, possible=0;
      for(const k in data){
        if(data[k] && typeof data[k].score === 'number'){ gained += data[k].score; possible += data[k].total; }
      }
      let summaryEl = document.getElementById('overallSummary');
      if(!summaryEl){ summaryEl = document.createElement('div'); summaryEl.id='overallSummary'; summaryEl.className='result'; document.body.appendChild(summaryEl); }
      if(possible > 0){
        const pct = Math.round((gained/possible)*100);
        let level = 'Unassessed';
        if(pct >= 85) level='B1+'; else if(pct >= 70) level='B1'; else if(pct >=50) level='A2'; else level='A1 or below';
        summaryEl.innerHTML = `<strong>Candidate:</strong> ${name} <br><strong>Total:</strong> ${gained}/${possible} (${pct}%) <br><strong>Suggested level:</strong> ${level}`;
        persist(name, 'overallSummary', { score:gained, total:possible, pct, level, timestamp:new Date().toISOString() });
      } else {
        summaryEl.innerHTML = `<strong>Candidate:</strong> ${name} <br><em>No submissions yet.</em>`;
      }
    }

    /* ========== Reading grading ========== */
    function gradeA1T1(){
      let score=0, total=3, notes=[];
      const q1 = document.querySelector('input[name="a1t1_q1"]:checked');
      const q2 = document.querySelector('input[name="a1t1_q2"]:checked');
      const q3 = normalize(document.getElementById('a1t1_q3').value);
      if(q1 && q1.value === '6') score++; else notes.push('Q1 expected 6:00 a.m.');
      if(q2 && q2.value === 'mark') score++; else notes.push('Q2 expected Mark.');
      if(q3.includes('bus')) score++; else notes.push('Q3 expected near a bus stop.');
      saveResult('resA1T1', score, total, notes);
    }

    function gradeA1T2(){
      let score=0, total=2, notes=[];
      const q1 = document.querySelector('input[name="a1t2_q1"]:checked');
      const q2 = normalize(document.getElementById('a1t2_q2').value);
      if(q1 && q1.value === 'plumber') score++; else notes.push('Q1 expected Plumber.');
      if(q2.includes('12') || q2.includes('12:30')) score++; else notes.push('Q2 expected 12:30.');
      saveResult('resA1T2', score, total, notes);
    }

    function gradeA2T1(){
      let score=0, total=2, notes=[];
      const q1 = document.querySelector('input[name="a2t1_q1"]:checked');
      const q2 = normalize(document.getElementById('a2t1_q2').value);
      if(q1 && q1.value === 'beach') score++; else notes.push('Q1 expected beach.');
      if(q2.includes('team')) score++; else notes.push('Q2 expected team leader.');
      saveResult('resA2T1', score, total, notes);
    }

    function gradeA2T2(){
      let score=0, total=2, notes=[];
      const q1 = document.querySelector('input[name="a2t2_q1"]:checked');
      const q2 = normalize(document.getElementById('a2t2_q2').value);
      if(q1 && q1.value === 'experience') score++; else notes.push('Q1 expected experience and a current visa.');
      if(q2.includes('start') || q2.includes('quick') || q2.includes('speak')) score++; else notes.push('Q2 expected start quickly and speak clear English.');
      saveResult('resA2T2', score, total, notes);
    }

    function gradeB1T1(){
      let score=0, total=2, notes=[];
      const q1 = document.querySelector('input[name="b1t1_q1"]:checked');
      const q2 = normalize(document.getElementById('b1t1_q2').value);
      if(q1 && q1.value === 'language') score++; else notes.push('Q1 expected NOT listed (learning a new language).');
      if(q2.includes('allow') || q2.includes('accommodation') || q2.includes('relocation')) score++; else notes.push('Q2 expected relocation allowance or temporary accommodation.');
      saveResult('resB1T1', score, total, notes);
    }

    function gradeB1T2(){
      let score=0, total=2, notes=[];
      const q1 = document.querySelector('input[name="b1t2_q1"]:checked');
      const q2 = normalize(document.getElementById('b1t2_q2').value);
      if(q1 && q1.value === 'equipment') score++; else notes.push('Q1 expected protective equipment and training.');
      if(q2.includes('aware') || q2.includes('risk') || q2.includes('improve')) score++; else notes.push('Q2 expected to stay aware of risks and improve procedures.');
      saveResult('resB1T2', score, total, notes);
    }

    /* ========== Writing grading ========== */
    function gradeEssay(){
      const text = document.getElementById('essayText').value || '';
      const wc = wordsCount(text);
      let score=0, total=20, notes=[];
      if(wc >= 150) score += 6; else notes.push('Essay length < 150 words (recommended).');
      if(/[.!?]/.test(text) && text.split(/[.!?]+/).filter(Boolean).length >= 3) score += 7; else notes.push('Use more sentences/paragraphs.');
      if(/\b(process|improv|result|problem|safety|work)\b/i.test(text)) score += 7; else notes.push('Include work-specific vocabulary & details.');
      if(score > total) score = total;
      // persist essay text separately for export
      persist(document.getElementById('candidateName').value.trim() || '(No name)', 'essay_text', { text: text, words: wc, timestamp: new Date().toISOString() });
      saveResult('resEssay', score, total, notes);
    }

    function gradeEmail(){
      const text = document.getElementById('emailText').value || '';
      const wc = wordsCount(text);
      let score=0, total=20, notes=[];
      if(wc >= 80) score += 5; else notes.push('Email length < 80 words (recommended).');
      if(/\b(dear|hello|hi)\b/i.test(text)) score += 5; else notes.push('Add a formal greeting (Dear ...).');
      if(/\b(please|thank|regards|sincerely)\b/i.test(text)) score += 5; else notes.push('Include polite language / closing.');
      if(/\b(date|time|alternative|available|can)\b/i.test(text)) score += 5; else notes.push('Provide clear alternative dates/times.');
      if(score > total) score = total;
      persist(document.getElementById('candidateName').value.trim() || '(No name)', 'email_text', { text: text, words: wc, timestamp: new Date().toISOString() });
      saveResult('resEmail', score, total, notes);
    }

    /* ========== Examiner controls & export ========== */
    function enableExaminerMode(){
      const admin = document.getElementById('adminControls');
      admin.classList.remove('hidden');
      alert('Examiner mode enabled. Clear and Export buttons are now visible at the bottom.');
    }

    function clearCandidateData(){
      const name = document.getElementById('candidateName').value.trim();
      if(!name){ alert('Please enter the candidate name first.'); return; }
      if(confirm(`Clear all saved data for "${name}"? This will remove data from this browser.`)){
        localStorage.removeItem('skilledtest_' + name);
        alert('Data cleared for ' + name + '.');
        // clear visible result areas
        const ids = ['resA1T1','resA1T2','resA2T1','resA2T2','resB1T1','resB1T2','resEssay','resEmail','overallSummary'];
        ids.forEach(id => { const el=document.getElementById(id); if(el) el.innerHTML=''; });
      }
    }

    function gatherAllForExport(name){
      const stored = loadStored(name);
      const items = [];

      // reading answers (from DOM)
      items.push({ title:'A1 Test 1', answers:{
        q1: (document.querySelector('input[name="a1t1_q1"]:checked')||{}).value || '',
        q2: (document.querySelector('input[name="a1t1_q2"]:checked')||{}).value || '',
        q3: document.getElementById('a1t1_q3').value || ''
      }, score: stored['resA1T1'] || null });

      items.push({ title:'A1 Test 2', answers:{
        q1: (document.querySelector('input[name="a1t2_q1"]:checked')||{}).value || '',
        q2: document.getElementById('a1t2_q2').value || ''
      }, score: stored['resA1T2'] || null });

      items.push({ title:'A2 Test 1', answers:{
        q1: (document.querySelector('input[name="a2t1_q1"]:checked')||{}).value || '',
        q2: document.getElementById('a2t1_q2').value || ''
      }, score: stored['resA2T1'] || null });

      items.push({ title:'A2 Test 2', answers:{
        q1: (document.querySelector('input[name="a2t2_q1"]:checked')||{}).value || '',
        q2: document.getElementById('a2t2_q2').value || ''
      }, score: stored['resA2T2'] || null });

      items.push({ title:'B1 Test 1', answers:{
        q1: (document.querySelector('input[name="b1t1_q1"]:checked')||{}).value || '',
        q2: document.getElementById('b1t1_q2').value || ''
      }, score: stored['resB1T1'] || null });

      items.push({ title:'B1 Test 2', answers:{
        q1: (document.querySelector('input[name="b1t2_q1"]:checked')||{}).value || '',
        q2: document.getElementById('b1t2_q2').value || ''
      }, score: stored['resB1T2'] || null });

      // essay & email (prefer persisted stored text)
      const essayData = stored['essay_text'] || { text: document.getElementById('essayText').value || '', words: wordsCount(document.getElementById('essayText').value || '') };
      items.push({ title:'Essay', answers:{ words: essayData.words, text: essayData.text }, score: stored['resEssay'] || null });

      const emailData = stored['email_text'] || { text: document.getElementById('emailText').value || '', words: wordsCount(document.getElementById('emailText').value || '') };
      items.push({ title:'Email', answers:{ words: emailData.words, text: emailData.text }, score: stored['resEmail'] || null });

      // overall summary if available
      items.push({ title:'Overall (Local)', answers: stored['overallSummary'] || null, score: stored['overallSummary'] || null });

      return { name, timestamp: new Date().toISOString(), items };
    }

    function confirmAndExport(){
      const name = document.getElementById('candidateName').value.trim();
      if(!name){ alert('Please enter your full name in the Candidate Name field before exporting.'); return; }
      const ok = confirm(`Please double-check that your full name is written as:\n\n"${name}"\n\nThis name will appear on your results and used in the suggested PDF filename.\n\nDo you want to continue and export your results?`);
      if(!ok) return;
      // proceed to build printable window with auto-title
      const data = gatherAllForExport(name);
      const filename = `SkilledJobs_EnglishResults_${name.replace(/[^a-z0-9_\\- ]/ig,'').replace(/\\s+/g,'_')}.pdf`;
      // Build clean printable HTML (simple)
      let html = `<div style="font-family:system-ui,Segoe UI,Roboto,Arial;max-width:780px;margin:20px auto;color:#0f172a;">`;
      html += `<h1>Skilled-Jobs English — Results</h1>`;
      html += `<p><strong>Candidate:</strong> ${data.name}<br><strong>Submitted:</strong> ${data.timestamp}</p>`;
      data.items.forEach(it => {
        html += `<hr><h3 style="margin-bottom:6px">${it.title}</h3>`;
        if(it.answers && typeof it.answers === 'object'){
          html += `<div style="font-size:0.95rem;white-space:pre-wrap;">`;
          for(const k in it.answers){
            html += `<strong>${k}:</strong> ${String(it.answers[k])}\n`;
          }
          html += `</div>`;
        } else {
          html += `<p>${JSON.stringify(it.answers)}</p>`;
        }
        if(it.score){
          html += `<p style="font-size:0.95rem"><strong>Score:</strong> ${it.score.score} / ${it.score.total}<br><strong>Notes:</strong> ${Array.isArray(it.score.notes)?it.score.notes.join(' '):''}</p>`;
        }
      });
      html += `<hr><p><em>Send this PDF to: susan.centino@cirrusrecruitment.com (or via Messenger if you do not have email).</em></p>`;
      html += `</div>`;

      // Open a new window and set its title (so Save as PDF suggests the filename)
      const win = window.open('', '_blank');
      if(!win){ alert('Popup blocked: please allow popups for this site to export results.'); return; }
      win.document.write(`<html><head><title>${filename}</title><meta charset="utf-8"></head><body>${html}</body></html>`);
      win.document.close();
      // give browser a moment to render then trigger print
      setTimeout(() => {
        try {
          win.focus();
          win.print();
        } catch(e) {
          // fallback: user can manually Save as PDF
        }
      }, 250);

      // Show thank-you message in main window after export prompt
      const post = document.getElementById('postExportMsg');
      post.classList.remove('hidden');
      post.innerHTML = `<strong>Thank you for participating in the English Assessment.</strong><br>
                        Our team will get in touch with you for the next process, so please keep your lines open.`;
    }

    /* Unlock examiner mode: Ctrl + Alt + E */
    document.addEventListener('keydown', function(e){
      if(e.ctrlKey && e.altKey && (e.key === 'E' || e.key === 'e')){
        enableExaminerMode();
      }
    });

    /* Wire up buttons when DOM is ready */
    document.addEventListener('DOMContentLoaded', function(){
      // reading
      document.getElementById('btnA1T1').addEventListener('click', gradeA1T1);
      document.getElementById('btnA1T2').addEventListener('click', gradeA1T2);
      document.getElementById('btnA2T1').addEventListener('click', gradeA2T1);
      document.getElementById('btnA2T2').addEventListener('click', gradeA2T2);
      document.getElementById('btnB1T1').addEventListener('click', gradeB1T1);
      document.getElementById('btnB1T2').addEventListener('click', gradeB1T2);

      // writing
      document.getElementById('btnEssay').addEventListener('click', gradeEssay);
      document.getElementById('btnEmail').addEventListener('click', gradeEmail);

      // admin
      document.getElementById('btnClearData').addEventListener('click', clearCandidateData);
      document.getElementById('btnExportPDF').addEventListener('click', confirmAndExport);

      // update summary when name field blurred
      document.getElementById('candidateName').addEventListener('blur', function(){
        const n = this.value.trim() || '(No name)';
        updateOverallSummary(n);
      });
    });
  </script>
</body>
</html>
